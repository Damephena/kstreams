#!/bin/sh -e

export PREFIX=""
if [ -d '.venv' ] ; then
    export PREFIX=".venv/bin/"
fi

export PYTHONPATH=kstreams
export SERVICE_KSTREAMS_ENVFILES_SECRETS=$(pwd)/params.env

${PREFIX}pytest -x --cov-report term-missing --cov-report=html --cov=kstreams ${1-"./tests"}
${PREFIX}black kstreams tests --check --diff
${PREFIX}flake8 kstreams/ tests/